From 413e34e287cf381b88cdd3a90f17ac070e12aa93 Mon Sep 17 00:00:00 2001
From: David Hoppenbrouwers <david@salt-inc.org>
Date: Fri, 3 Jun 2022 03:22:41 +0200
Subject: [PATCH 43/44] Always enable red zone on kernel targets

---
 .../rustc_target/src/spec/i686_unknown_none_norostbkernel.rs     | 1 +
 .../rustc_target/src/spec/x86_64_unknown_none_norostbkernel.rs   | 1 +
 2 files changed, 2 insertions(+)

diff --git a/compiler/rustc_target/src/spec/i686_unknown_none_norostbkernel.rs b/compiler/rustc_target/src/spec/i686_unknown_none_norostbkernel.rs
index 7d5e1b48d81..22f1e07120d 100644
--- a/compiler/rustc_target/src/spec/i686_unknown_none_norostbkernel.rs
+++ b/compiler/rustc_target/src/spec/i686_unknown_none_norostbkernel.rs
@@ -13,6 +13,7 @@ pub fn target() -> Target {
             features:
                 "-mmx,-sse,-sse2,-sse3,-ssse3,-sse4.1,-sse4.2,-3dnow,-3dnowa,-avx,-avx2,+soft-float"
                     .into(),
+            disable_redzone: true,
             ..super::norostb_kernel_base::opts()
         },
     }
diff --git a/compiler/rustc_target/src/spec/x86_64_unknown_none_norostbkernel.rs b/compiler/rustc_target/src/spec/x86_64_unknown_none_norostbkernel.rs
index a1ab329068f..363e1d23d03 100644
--- a/compiler/rustc_target/src/spec/x86_64_unknown_none_norostbkernel.rs
+++ b/compiler/rustc_target/src/spec/x86_64_unknown_none_norostbkernel.rs
@@ -13,6 +13,7 @@ pub fn target() -> Target {
             features:
                 "-mmx,-sse,-sse2,-sse3,-ssse3,-sse4.1,-sse4.2,-3dnow,-3dnowa,-avx,-avx2,+soft-float"
                     .into(),
+            disable_redzone: true,
             ..super::norostb_kernel_base::opts()
         },
     }
-- 
2.30.2

