From 3df187f25aa382de502ccdc87212a8d7c8cb136c Mon Sep 17 00:00:00 2001
From: David Hoppenbrouwers <david@salt-inc.org>
Date: Sat, 23 Apr 2022 14:49:40 +0200
Subject: [PATCH 28/43] Temporary workaround for broken syscall::queue_next

---
 library/std/src/sys/norostb/io.rs | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/library/std/src/sys/norostb/io.rs b/library/std/src/sys/norostb/io.rs
index eabc9ef11ca..551bc2d8436 100644
--- a/library/std/src/sys/norostb/io.rs
+++ b/library/std/src/sys/norostb/io.rs
@@ -172,7 +172,9 @@ pub fn query(table: syscall::TableId, path: &[u8]) -> io::Result<syscall::Handle
 pub fn query_next(query: syscall::Handle, info: &mut ObjectInfo) -> io::Result<bool> {
     let e = enqueue(Request::query_next(0, query, info));
     if e.value < 0 {
-        Err(io::const_io_error!(io::ErrorKind::Uncategorized, "failed to advance query"))
+        // FIXME the API for quering is kinda broken right now.
+        //Err(io::const_io_error!(io::ErrorKind::Uncategorized, "failed to advance query"))
+        Ok(false)
     } else {
         Ok(e.value > 0)
     }
-- 
2.30.2

